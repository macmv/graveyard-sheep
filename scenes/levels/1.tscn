[gd_scene load_steps=19 format=2]

[ext_resource path="res://assets/level/1/background.png" type="Texture" id=1]
[ext_resource path="res://assets/effects/light.png" type="Texture" id=2]
[ext_resource path="res://scenes/enemies/zombie.tscn" type="PackedScene" id=3]
[ext_resource path="res://scripts/nav.gd" type="Script" id=4]
[ext_resource path="res://scripts/level.gd" type="Script" id=5]

[sub_resource type="Shader" id=1]
code = "shader_type canvas_item;

uniform sampler2D curve;
uniform sampler2D noise;

void fragment() {
  COLOR = vec4(texture(TEXTURE, UV).xyz, 1);
}

void light() {
  float dist = length(LIGHT_UV - vec2(0.5)) * 2.0;
  float curve_amount = texture(curve, vec2(dist, 0)).x;
  LIGHT_COLOR = vec4(curve_amount);
  LIGHT_COLOR.a = 1.0;
  LIGHT = LIGHT_COLOR;
}
"

[sub_resource type="Curve" id=2]
_data = [ Vector2( 0, 0.994369 ), 0.0, -1.17123, 0, 0, Vector2( 1, 0 ), 0.0, 0.0, 0, 0 ]

[sub_resource type="CurveTexture" id=3]
curve = SubResource( 2 )

[sub_resource type="OpenSimplexNoise" id=4]
octaves = 5
period = 0.1
persistence = 0.598

[sub_resource type="NoiseTexture" id=5]
width = 256
height = 256
noise = SubResource( 4 )

[sub_resource type="ShaderMaterial" id=6]
shader = SubResource( 1 )
shader_param/curve = SubResource( 3 )
shader_param/noise = SubResource( 5 )

[sub_resource type="OccluderPolygon2D" id=7]
polygon = PoolVector2Array( 506.6, 1163.4, 435.89, 1170.47, 430.233, 956.929, 295.883, 836.72, 46.921, 846.107, 56.8805, 1550.9, 150.219, 1644.24, 151.633, 1862.03, 222.343, 2260.83, 324.167, 2239.62, 394.877, 2245.28, 421.747, 2352.76, 380.735, 2406.5, 312.853, 2430.54, 171.432, 2395.18, 219.515, 3226.74, 605.595, 3349.78, 1208.05, 3366.75, 1318.36, 3272, 1686.05, 3239.47, 1721.41, 3120.68, 1782.22, 2755.81, 1729.9, 2290.53, 1595.54, 2262.25, 1572.92, 2044.46, 1703.03, 2044.46, 1707.27, 1845.05, 1775.15, 1784.24, 1782.22, 1620.19, 1876.97, 1545.24, 1864.25, 852.276, 1649.28, 843.791, 1611.1, 937.129, 1523.42, 968.242, 1514.93, 1126.63, 1420.18, 1126.63, 1400.72, 918.574, 1405.32, 797.925, 1434.32, 741.968, 1855.76, 741.968, 1845.78, 73.1735, 1912.54, -16.0205, 1913.43, 3428.63, 0.75, 3451.08, -22.58, -7.51099, 1913.59, -15.4345, 1845.52, 72.9152, 66.7797, 68.802, 55.2454, 735.511, 346.794, 753.281, 440.132, 732.068, 520.742, 801.365, 546.198, 879.146, 515.085, 965.414 )

[sub_resource type="OccluderPolygon2D" id=8]
polygon = PoolVector2Array( 1428.43, 1396.2, 1430.68, 1606.66, 1357.16, 1653.24, 1155.53, 1641.75, 1139.18, 1655.69, 1139.4, 1718.34, 1148.94, 1734.62, 1613.64, 1728.45, 1611.39, 1644.82, 1521.6, 1625.74, 1522.16, 1404.61 )

[sub_resource type="OccluderPolygon2D" id=9]
polygon = PoolVector2Array( 313.555, 1641.89, 315.142, 1731.98, 434.991, 1747.85, 482.613, 1788.73, 531.822, 1792.7, 586.985, 1758.17, 781.838, 1758.96, 795.728, 1793.89, 1049.32, 1971.68, 1087.81, 1920.48, 800.093, 1723.25, 779.457, 1643.48, 604.446, 1648.24, 498.09, 1612.53, 499.28, 1403.39, 402.449, 1406.16, 392.528, 1640.31 )

[sub_resource type="NavigationPolygon" id=10]
vertices = PoolVector2Array( 945.615, 3269.88, 1333.73, 3551.64, 593.5, 3560.5, 876.563, 3266.7, 607.498, 3310.36, 279.5, 3224.5, 335.5, 3200.5, 455.108, 3146.06, 804.336, 3193.68, 239.5, 3008.5, 207.5, 3024.5, 199.5, 2792.5, 486.856, 2199.97, 259.857, 1992.81, 172.55, 1785.66, 733.971, 1791.25, 1055.31, 2014.91, 328.909, 2969.06, 247.5, 2784.5, 247.952, 2238.07, 1269.27, 2298.27, 1599.5, 2304.5, 1583.5, 2376.5, 1457.48, 2449.1, 1607.5, 3072.5, 1711.5, 3120.5, 1647.5, 3216.5, 1501.14, 3156.31, 1312.87, 3146.09, 1312.3, 3244.48, 1024.19, 3209.56, 191.5, 2576.5, 193.186, 2439.67, 396.374, 2464.27, 239.5, 2584.5, 330.497, 2601.58, 313.035, 2762.7, 1289.08, 2834.52, 1235.57, 2996.25, 1103.75, 1769.67, 1676.4, 1775.01, 1669.72, 1993.92, 1492.19, 2031.3, 1263.93, 2143.42, 1130.9, 1916.63, 1816.04, 90.4956, 1821.15, 719.721, 1381.33, 715.238, 89.0638, 88.3642, 463.069, 699.617, 1274.66, 809.654, 576.639, 841.727, 1549.63, 1167.88, 1665.67, 883.653, 1834.69, 881.131, 1832.57, 1506.71, 1691.08, 1608.15, 1569.61, 1581.46, 1550.92, 1374.56, 1389.4, 1361.21, 1374.72, 1163.67, 93.8206, 706.157, 531.179, 1355.34, 539.773, 1196.71, 1277.18, 913.085, 800.802, 1611.73, 550.078, 1608.58, 213.049, 1631.26, 85.1852, 1551.48, 75.3854, 876.175, 276.728, 867.266, 378.291, 977.737, 405.393, 1207.41, 378.099, 1360.38, 1358.7, 1598.81, 1091.74, 1601.48, 509.079, 2334.1, 364.927, 1610.28, 1199.6, 3325.44, 1371.36, 956.811, 843.01, 1705.6, 1557.59, 2559.89, 1575.5, 2768.5, 1535.5, 2824.5 )
polygons = [ PoolIntArray( 0, 1, 2, 3 ), PoolIntArray( 4, 5, 6 ), PoolIntArray( 4, 6, 7, 8 ), PoolIntArray( 9, 10, 11 ), PoolIntArray( 12, 13, 14, 15, 16 ), PoolIntArray( 17, 9, 11, 18 ), PoolIntArray( 12, 19, 13 ), PoolIntArray( 20, 21, 22, 23 ), PoolIntArray( 24, 25, 26, 27 ), PoolIntArray( 28, 27, 26, 29, 30 ), PoolIntArray( 31, 32, 33, 34 ), PoolIntArray( 35, 34, 33 ), PoolIntArray( 7, 17, 18, 36, 37, 38, 30, 8 ), PoolIntArray( 39, 40, 41, 42 ), PoolIntArray( 39, 42, 43, 44 ), PoolIntArray( 45, 46, 47, 48 ), PoolIntArray( 49, 48, 47, 50, 51 ), PoolIntArray( 52, 53, 54, 55, 56, 57, 58 ), PoolIntArray( 52, 58, 59, 60 ), PoolIntArray( 49, 61, 48 ), PoolIntArray( 62, 63, 51, 50, 64, 65, 66 ), PoolIntArray( 67, 68, 69, 70, 71, 72, 73 ), PoolIntArray( 59, 74, 75 ), PoolIntArray( 76, 12, 16, 43, 20 ), PoolIntArray( 73, 77, 67 ), PoolIntArray( 62, 73, 72, 63 ), PoolIntArray( 29, 78, 30 ), PoolIntArray( 38, 28, 30 ), PoolIntArray( 65, 64, 79, 60 ), PoolIntArray( 65, 60, 59, 75, 80 ), PoolIntArray( 80, 75, 39 ), PoolIntArray( 44, 80, 39 ), PoolIntArray( 16, 44, 43 ), PoolIntArray( 35, 33, 76, 20, 23, 81, 82, 83, 37, 36 ), PoolIntArray( 3, 8, 30, 0 ) ]
outlines = [ PoolVector2Array( 89.0638, 88.3642, 93.8206, 706.157, 463.069, 699.617, 576.639, 841.727, 539.773, 1196.71, 405.393, 1207.41, 378.291, 977.737, 276.728, 867.266, 75.3854, 876.175, 85.1852, 1551.48, 213.049, 1631.26, 364.927, 1610.28, 378.099, 1360.38, 531.179, 1355.34, 550.078, 1608.58, 800.802, 1611.73, 843.01, 1705.6, 1130.9, 1916.63, 1055.31, 2014.91, 733.971, 1791.25, 172.55, 1785.66, 259.857, 1992.81, 247.952, 2238.07, 486.856, 2199.97, 509.079, 2334.1, 396.374, 2464.27, 193.186, 2439.67, 191.5, 2576.5, 239.5, 2584.5, 330.497, 2601.58, 313.035, 2762.7, 247.5, 2784.5, 199.5, 2792.5, 207.5, 3024.5, 239.5, 3008.5, 328.909, 2969.06, 455.108, 3146.06, 335.5, 3200.5, 279.5, 3224.5, 607.498, 3310.36, 804.336, 3193.68, 876.563, 3266.7, 593.5, 3560.5, 1333.73, 3551.64, 945.615, 3269.88, 1024.19, 3209.56, 1199.6, 3325.44, 1312.3, 3244.48, 1647.5, 3216.5, 1711.5, 3120.5, 1607.5, 3072.5, 1501.14, 3156.31, 1312.87, 3146.09, 1235.57, 2996.25, 1289.08, 2834.52, 1535.5, 2824.5, 1575.5, 2768.5, 1557.59, 2559.89, 1457.48, 2449.1, 1583.5, 2376.5, 1599.5, 2304.5, 1269.27, 2298.27, 1263.93, 2143.42, 1492.19, 2031.3, 1669.72, 1993.92, 1676.4, 1775.01, 1103.75, 1769.67, 1091.74, 1601.48, 1358.7, 1598.81, 1389.4, 1361.21, 1550.92, 1374.56, 1569.61, 1581.46, 1691.08, 1608.15, 1832.57, 1506.71, 1834.69, 881.131, 1665.67, 883.653, 1549.63, 1167.88, 1374.72, 1163.67, 1371.36, 956.811, 1277.18, 913.085, 1274.66, 809.654, 1381.33, 715.238, 1821.15, 719.721, 1816.04, 90.4956 ) ]

[sub_resource type="NavigationPolygon" id=11]
vertices = PoolVector2Array( 1702.17, 2513.29, 1584.67, 2375.33, 1600.67, 2303.33, 1699.79, 2328.36, 1756.94, 2504.56, 1767.26, 2756.96, 1710.11, 2747.43, 1678.36, 2802.2, 1710.9, 2924.43, 1636.13, 2899.04, 1536.67, 2823.33, 1576.67, 2767.33 )
polygons = [ PoolIntArray( 0, 1, 2, 3, 4 ), PoolIntArray( 0, 4, 5, 6 ), PoolIntArray( 7, 6, 5, 8, 9 ), PoolIntArray( 7, 9, 10, 11 ) ]
outlines = [ PoolVector2Array( 1584.67, 2375.33, 1600.67, 2303.33, 1699.79, 2328.36, 1756.94, 2504.56, 1767.26, 2756.96, 1710.9, 2924.43, 1636.13, 2899.04, 1536.67, 2823.33, 1576.67, 2767.33, 1678.36, 2802.2, 1710.11, 2747.43, 1702.17, 2513.29 ) ]

[sub_resource type="NavigationPolygon" id=12]
vertices = PoolVector2Array( 274.584, 3112.33, 336, 3200, 280, 3224, 226.318, 3139.83, 208, 3024, 240, 3008 )
polygons = [ PoolIntArray( 0, 1, 2, 3, 4 ), PoolIntArray( 4, 5, 0 ) ]
outlines = [ PoolVector2Array( 208, 3024, 226.318, 3139.83, 280, 3224, 336, 3200, 274.584, 3112.33, 240, 3008 ) ]

[sub_resource type="NavigationPolygon" id=13]
vertices = PoolVector2Array( 221.917, 2683.45, 248, 2784, 200, 2792, 180.069, 2682.39, 192, 2576, 240, 2584 )
polygons = [ PoolIntArray( 0, 1, 2, 3, 4 ), PoolIntArray( 0, 4, 5 ) ]
outlines = [ PoolVector2Array( 200, 2792, 180.069, 2682.39, 192, 2576, 240, 2584, 221.917, 2683.45, 248, 2784 ) ]

[node name="Level" type="StaticBody2D"]
script = ExtResource( 5 )

[node name="background" type="Sprite" parent="."]
material = SubResource( 6 )
position = Vector2( 960, 1708 )
scale = Vector2( 2.78443, 2.78443 )
texture = ExtResource( 1 )
region_rect = Rect2( 0, 0, 100, 100 )

[node name="LightOccluder2D" type="LightOccluder2D" parent="."]
occluder = SubResource( 7 )

[node name="LightOccluder2D2" type="LightOccluder2D" parent="."]
occluder = SubResource( 8 )

[node name="LightOccluder2D3" type="LightOccluder2D" parent="."]
occluder = SubResource( 9 )

[node name="CollisionPolygon2D" type="CollisionPolygon2D" parent="."]
position = Vector2( 964.374, 1711.52 )
scale = Vector2( 2.78329, 2.78329 )
polygon = PoolVector2Array( -324.52, -593.133, -325.719, -348.782, -217.811, -343.267, -186.397, -349.501, -163.137, -330.078, -149.949, -298.185, -161.938, -263.175, -164.576, -198.19, -189.755, -196.752, -190.954, -272.767, -211.816, -276.124, -230.28, -294.348, -240.591, -319.287, -331.731, -314.253, -329.499, -55.9935, -293.929, -26.532, -291.856, -14.6943, -234.452, -14.6943, -233.546, -25.2686, -206.355, -25.8729, -201.521, -109.863, -164.964, -110.769, -162.547, -64.2425, -139.284, -68.4722, -119.948, -53.6682, -126.594, -24.3622, -65.2634, -25.8729, -56.1997, 3.13098, 46.22, 74.7341, 31.416, 94.3721, -79.1611, 17.6328, -134.148, 18.2371, -145.024, 30.9262, -169.194, 32.4368, -189.134, 13.4031, -233.244, 7.66272, -292.46, 10.9861, -292.133, 53.9483, -266.983, 99.2184, -267.517, 202.078, -233.114, 190.308, -205.274, 193.93, -181.735, 180.576, -173.361, 200.946, -173.587, 224.033, -193.505, 233.539, -212.97, 252.325, -239.225, 259.794, -284.007, 245.292, -288.808, 368.206, -282.492, 489.096, -257.821, 549.075, -128.767, 585.111, -60.2081, 541.557, -46.4964, 561.318, -103.216, 606.991, -143.514, 669.074, 151.443, 666.025, 66.7762, 608.69, 4.17938, 559.349, 16.2917, 548.044, 87.8885, 596.493, 130.954, 563.117, 258.267, 548.852, 274.417, 501.749, 231.351, 481.561, 193.669, 510.631, 141.721, 500.134, 108.345, 459.49, 120.188, 413.195, 139.298, 423.961, 175.097, 406.735, 218.701, 414.809, 232.159, 436.881, 275.016, 445.507, 292.82, 375.648, 290.082, 280.655, 272.861, 206.903, 224.467, 199.644, 123.847, 191.175, 123.04, 163.953, 216.804, 121.003, 266.005, 119.39, 268.626, 48.815, 289.396, 25.4246, 284.341, 7.16003, 233.784, 6.1438, 62.5514, 7.41412, 65.8541, -24.3427, 140.8, -20.0238, 167.476, -36.7913, 167.222, -113.516, 198.47, -111.483, 203.806, -28.4075, 234.546, -16.213, 288.66, -15.1967, 293.832, -32.6486, 325.288, -59.6688, 319.15, -312.265, 244.828, -312.567, 226.096, -278.125, 198.301, -267.853, 198.301, -209.241, 161.14, -209.845, 156.513, -284.981, 127.688, -293.799, 127.009, -316.859, 165.672, -344.29, 319.755, -347.009, 318.41, -588.752, 344.497, -613.478, 344.431, 616.614, -6.57837, 733.096, -343.119, 611.492, -349.705, -614.686, 343.216, -615.079, 316.649, -591.392 )

[node name="CollisionPolygon2D2" type="CollisionPolygon2D" parent="."]
position = Vector2( 0, -0.00012207 )
polygon = PoolVector2Array( 1493.59, 2459.82, 1595.83, 2537.69, 1606.95, 2741.63, 1684.29, 2741.63, 1682.17, 2515.97, 1629.73, 2497.43, 1574.11, 2401.02 )

[node name="CollisionPolygon2D3" type="CollisionPolygon2D" parent="."]
polygon = PoolVector2Array( 271.899, 2605.38, 240.272, 2633, 242.945, 2710.95, 271.454, 2743.47, 290.88, 2747.13, 301.589, 2605.38 )

[node name="CollisionPolygon2D4" type="CollisionPolygon2D" parent="."]
polygon = PoolVector2Array( 264.422, 3018.64, 286.47, 3103.68, 365.845, 3149.04, 412.462, 3128.25, 301.589, 2995.33 )

[node name="Lights" type="Node2D" parent="."]

[node name="Light2D" type="Light2D" parent="Lights"]
use_parent_material = true
position = Vector2( 1386.35, 1071.62 )
scale = Vector2( 3.16577, 3.16577 )
texture = ExtResource( 2 )
shadow_enabled = true
shadow_color = Color( 0, 0, 0, 1 )

[node name="Light2D2" type="Light2D" parent="Lights"]
use_parent_material = true
position = Vector2( 540.902, 1050.43 )
scale = Vector2( 3.0195, 3.0195 )
texture = ExtResource( 2 )
shadow_enabled = true
shadow_color = Color( 0, 0, 0, 1 )

[node name="Light2D10" type="Light2D" parent="Lights"]
use_parent_material = true
position = Vector2( 163.755, 915.733 )
scale = Vector2( 3.0195, 3.0195 )
texture = ExtResource( 2 )
shadow_enabled = true
shadow_color = Color( 0, 0, 0, 1 )

[node name="Light2D11" type="Light2D" parent="Lights"]
use_parent_material = true
position = Vector2( 1723.98, 900.018 )
scale = Vector2( 3.4146, 3.4146 )
texture = ExtResource( 2 )
shadow_enabled = true
shadow_color = Color( 0, 0, 0, 1 )

[node name="Light2D3" type="Light2D" parent="Lights"]
use_parent_material = true
position = Vector2( 91.6899, 423.226 )
scale = Vector2( 2.97528, 2.97528 )
texture = ExtResource( 2 )
shadow_enabled = true
shadow_color = Color( 0, 0, 0, 1 )

[node name="Light2D4" type="Light2D" parent="Lights"]
use_parent_material = true
position = Vector2( 574.805, 115.982 )
scale = Vector2( 3.01338, 3.01338 )
texture = ExtResource( 2 )
shadow_enabled = true
shadow_color = Color( 0, 0, 0, 1 )

[node name="Light2D5" type="Light2D" parent="Lights"]
use_parent_material = true
position = Vector2( 1339.74, 88.4356 )
scale = Vector2( 3.53405, 3.53405 )
texture = ExtResource( 2 )
shadow_enabled = true
shadow_color = Color( 0, 0, 0, 1 )

[node name="Light2D6" type="Light2D" parent="Lights"]
use_parent_material = true
position = Vector2( 1808.02, 406.275 )
scale = Vector2( 4.05472, 4.05472 )
texture = ExtResource( 2 )
shadow_enabled = true
shadow_color = Color( 0, 0, 0, 1 )

[node name="Light2D7" type="Light2D" parent="Lights"]
use_parent_material = true
position = Vector2( 445.782, 2233.64 )
scale = Vector2( 1.92943, 1.92943 )
texture = ExtResource( 2 )
shadow_enabled = true
shadow_color = Color( 0, 0, 0, 1 )

[node name="Light2D8" type="Light2D" parent="Lights"]
use_parent_material = true
position = Vector2( 240, 2464 )
scale = Vector2( 2.23892, 2.23892 )
texture = ExtResource( 2 )
shadow_enabled = true
shadow_color = Color( 0, 0, 0, 1 )

[node name="Light2D9" type="Light2D" parent="Lights"]
use_parent_material = true
position = Vector2( 1571.51, 2490 )
scale = Vector2( 2.636, 2.636 )
texture = ExtResource( 2 )
shadow_enabled = true
shadow_color = Color( 0, 0, 0, 1 )

[node name="Navigation2D" type="Navigation2D" parent="."]
script = ExtResource( 4 )

[node name="NavigationPolygonInstance" type="NavigationPolygonInstance" parent="Navigation2D"]
position = Vector2( 0.5, -0.5 )
navpoly = SubResource( 10 )

[node name="NavigationPolygonInstance2" type="NavigationPolygonInstance" parent="Navigation2D"]
position = Vector2( -0.667358, 0.667236 )
navpoly = SubResource( 11 )

[node name="NavigationPolygonInstance3" type="NavigationPolygonInstance" parent="Navigation2D"]
navpoly = SubResource( 12 )

[node name="NavigationPolygonInstance4" type="NavigationPolygonInstance" parent="Navigation2D"]
navpoly = SubResource( 13 )

[node name="Zombie" parent="." instance=ExtResource( 3 )]
position = Vector2( 462.985, 416.369 )
